<!DOCTYPE html>
<html lang="el">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Πίνακας Ελέγχου</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/script.js" defer></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
</head>

<body>
    <div class="sidebar">
        <h2>Πίνακας Ελέγχου</h2>
        <ul>
            <li><a href="/">Πίνακας Ελέγχου</a></li>
            <li><a href="/conditions">Συνθήκες</a></li>
            <li><a href="/compuland">Compuland Α.Ε.</a></li>
            <li><a href="/devices">Συσκευές</a></li>
        </ul>
    </div>
    <div class="content">
        <div class="container">
            <h1>Πίνακας Δεδομένων Συσκευής</h1>
            <div class="card">
                <h2>Θερμοκρασία</h2>
                <div class="data">
                    <span id="temperature">N/A</span>
                    <span class="unit">°C</span>
                </div>
            </div>
            <div class="card">
                <h2>Υγρασία</h2>
                <div class="data">
                    <span id="humidity">N/A</span>
                    <span class="unit">%</span>
                </div>
            </div>
            <div class="card">
                <h2>Solenoid 1</h2>
                <div class="data">
                    <button id="solenoid1-button" class="solenoid-button">Ανοικτή</button>
                </div>
            </div>
            <div class="card">
                <h2>Solenoid 2</h2>
                <div class="data">
                    <button id="solenoid2-button" class="solenoid-button">Ανοικτή</button>
                </div>
            </div>
            <div class="card">
                <h2>Test</h2>
                <div class="data">
                    <button id="test-button" class="test-button">Test</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const temperatureElement = document.getElementById('temperature');
            const humidityElement = document.getElementById('humidity');
            const solenoid1Button = document.getElementById('solenoid1-button');
            const solenoid2Button = document.getElementById('solenoid2-button');
            const testButton = document.getElementById('test-button');

            const socket = io();

            socket.on('update_data', function (data) {
                const temperature = data.temperature;
                const humidity = data.humidity;
                const solenoid1Status = data.solenoid_1_status;
                const solenoid2Status = data.solenoid_2_status;

                // Update temperature and humidity
                temperatureElement.textContent = temperature !== null ? temperature.toFixed(1) : 'N/A';
                humidityElement.textContent = humidity !== null ? humidity.toFixed(1) : 'N/A';

                // Update solenoid 1 button status
                solenoid1Button.textContent = solenoid1Status === 1 ? 'Κλειστή' : 'Ανοικτή';

                // Update solenoid 2 button status
                solenoid2Button.textContent = solenoid2Status === 1 ? 'Κλειστή' : 'Ανοικτή';
            });

            solenoid1Button.addEventListener('click', function () {
                fetch('/toggle_solenoid_1', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        const status = data.solenoid_1_status;
                        solenoid1Button.textContent = status === 1 ? 'Κλειστή' : 'Ανοικτή';
                    })
                    .catch(error => console.error('Error toggling solenoid 1:', error));
            });

            solenoid2Button.addEventListener('click', function () {
                fetch('/toggle_solenoid_2', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        const status = data.solenoid_2_status;
                        solenoid2Button.textContent = status === 1 ? 'Κλειστή' : 'Ανοικτή';
                    })
                    .catch(error => console.error('Error toggling solenoid 2:', error));
            });

            testButton.addEventListener('click', function () {
                fetch('/test', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => console.log('Test data logged successfully:', data))
                    .catch(error => console.error('Error sending test request:', error));
            });
        });
    </script>
</body>

</html>