<!DOCTYPE html>
<html lang="el">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Συνθήκες</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@6.1.1/dist/stomp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.2/dist/sockjs.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const socket = new SockJS('/socket');
            const stompClient = Stomp.over(socket);

            stompClient.connect({}, function (frame) {
                stompClient.subscribe('/topic/update_data', function (message) {
                    const data = JSON.parse(message.body);
                    document.getElementById('temperature').innerText = data.temperature || 'N/A';
                    document.getElementById('humidity').innerText = data.humidity || 'N/A';
                    document.getElementById('solenoid_1_status').innerText = data.solenoid_1_status ? 'Ανοιχτό' : 'Κλειστό';
                    document.getElementById('solenoid_2_status').innerText = data.solenoid_2_status ? 'Ανοιχτό' : 'Κλειστό';
                });
            });

            document.getElementById('add_time_trigger').addEventListener('submit', function (e) {
                e.preventDefault();
                const time = document.getElementById('trigger_time').value;
                const solenoid = document.getElementById('trigger_solenoid').value;
                const action = document.querySelector('input[name="trigger_action"]:checked').value;
                fetch('/add_time_trigger', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ time, solenoid, action })
                })
                    .then(response => response.json())
                    .then(data => {
                        updateTriggersList(data.triggers);
                    });
            });

            document.getElementById('add_temperature_trigger').addEventListener('submit', function (e) {
                e.preventDefault();
                const temperature = document.getElementById('trigger_temperature').value;
                const solenoid = document.getElementById('trigger_solenoid_temp').value;
                const action = document.querySelector('input[name="trigger_action_temp"]:checked').value;
                fetch('/add_temperature_trigger', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ temperature, solenoid, action })
                })
                    .then(response => response.json())
                    .then(data => {
                        updateTriggersList(data.triggers);
                    });
            });

            document.getElementById('add_humidity_trigger').addEventListener('submit', function (e) {
                e.preventDefault();
                const humidity = document.getElementById('trigger_humidity').value;
                const solenoid = document.getElementById('trigger_solenoid_hum').value;
                const action = document.querySelector('input[name="trigger_action_hum"]:checked').value;
                fetch('/add_humidity_trigger', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ humidity, solenoid, action })
                })
                    .then(response => response.json())
                    .then(data => {
                        updateTriggersList(data.triggers);
                    });
            });

            function updateTriggersList(triggers) {
                const list = document.getElementById('triggers_list');
                list.innerHTML = '';
                triggers.forEach(trigger => {
                    const li = document.createElement('li');
                    li.textContent = JSON.stringify(trigger);
                    list.appendChild(li);
                });
            }
        });
    </script>
</head>

<body>
    <div class="sidebar">
        <h2>Μενού</h2>
        <ul>
            <li><a href="/">Πίνακας Ελέγχου</a></li>
            <li><a href="/conditions">Συνθήκες</a></li>
            <li><a href="/compuland">Compuland Α.Ε.</a></li>
            <li><a href="/devices">Συσκευές</a></li>
        </ul>
    </div>
    <div class="content">
        <h1>Διαχείριση Συνθηκών</h1>
        <h2>Προσθήκη Χρονοπρογραμματισμένου Trigger</h2>
        <form id="add_time_trigger">
            <label for="trigger_time">Ώρα (HH:MM):</label>
            <input type="text" id="trigger_time" name="trigger_time" required>
            <br>
            <label for="trigger_solenoid">Σολυνωτής (1 ή 2):</label>
            <input type="number" id="trigger_solenoid" name="trigger_solenoid" min="1" max="2" required>
            <br>
            <label>Ενέργεια:</label>
            <input type="radio" id="open_time" name="trigger_action" value="open" checked>
            <label for="open_time">Άνοιγμα</label>
            <input type="radio" id="close_time" name="trigger_action" value="close">
            <label for="close_time">Κλείσιμο</label>
            <br>
            <button type="submit">Προσθήκη Trigger</button>
        </form>

        <h2>Προσθήκη Trigger Βασισμένο σε Θερμοκρασία</h2>
        <form id="add_temperature_trigger">
            <label for="trigger_temperature">Θερμοκρασία (°C):</label>
            <input type="number" id="trigger_temperature" name="trigger_temperature" required>
            <br>
            <label for="trigger_solenoid_temp">Σολυνωτής (1 ή 2):</label>
            <input type="number" id="trigger_solenoid_temp" name="trigger_solenoid_temp" min="1" max="2" required>
            <br>
            <label>Ενέργεια:</label>
            <input type="radio" id="open_temp" name="trigger_action_temp" value="open" checked>
            <label for="open_temp">Άνοιγμα</label>
            <input type="radio" id="close_temp" name="trigger_action_temp" value="close">
            <label for="close_temp">Κλείσιμο</label>
            <br>
            <button type="submit">Προσθήκη Trigger</button>
        </form>

        <h2>Προσθήκη Trigger Βασισμένο σε Υγρασία</h2>
        <form id="add_humidity_trigger">
            <label for="trigger_humidity">Υγρασία (%):</label>
            <input type="number" id="trigger_humidity" name="trigger_humidity" required>
            <br>
            <label for="trigger_solenoid_hum">Σολυνωτής (1 ή 2):</label>
            <input type="number" id="trigger_solenoid_hum" name="trigger_solenoid_hum" min="1" max="2" required>
            <br>
            <label>Ενέργεια:</label>
            <input type="radio" id="open_hum" name="trigger_action_hum" value="open" checked>
            <label for="open_hum">Άνοιγμα</label>
            <input type="radio" id="close_hum" name="trigger_action_hum" value="close">
            <label for="close_hum">Κλείσιμο</label>
            <