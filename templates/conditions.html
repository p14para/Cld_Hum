<!DOCTYPE html>
<html lang="el">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Συνθήκες</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/script.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.0/socket.io.min.js"></script>
</head>

<body>
    <div class="sidebar">
        <h2>Πίνακας Ελέγχου</h2>
        <ul>
            <li><a href="/">Πίνακας Ελέγχου</a></li>
            <li><a href="/conditions">Συνθήκες</a></li>
            <li><a href="/compuland">Compuland Α.Ε.</a></li>
            <li><a href="/devices">Συσκευές</a></li>
        </ul>
    </div>

    <div class="content">
        <h1>Διαχείριση Συνθηκών</h1>
        <form id="trigger-form">
            <h2>Προσθήκη Συνθήκης</h2>
            <label for="temperature">Θερμοκρασία:</label>
            <input type="number" id="temperature" name="temperature" step="0.1">
            <label for="temperature_comparison">Σύγκριση Θερμοκρασίας:</label>
            <select id="temperature_comparison" name="temperature_comparison">
                <option value="greater_than">Μεγαλύτερη από</option>
                <option value="less_than">Μικρότερη από</option>
                <option value="equal_to">Ίση με</option>
            </select>
            <label for="humidity">Υγρασία:</label>
            <input type="number" id="humidity" name="humidity" step="0.1">
            <label for="humidity_comparison">Σύγκριση Υγρασίας:</label>
            <select id="humidity_comparison" name="humidity_comparison">
                <option value="greater_than">Μεγαλύτερη από</option>
                <option value="less_than">Μικρότερη από</option>
                <option value="equal_to">Ίση με</option>
            </select>
            <label for="time">Ώρα:</label>
            <input type="time" id="time" name="time">
            <label for="solenoid">Σολένοιντ:</label>
            <select id="solenoid" name="solenoid">
                <option value="solenoid_1">Σολένοιντ 1</option>
                <option value="solenoid_2">Σολένοιντ 2</option>
            </select>
            <button type="submit">Προσθήκη Συνθήκης</button>
        </form>

        <h2>Ενεργές Συνθήκες</h2>
        <table id="trigger-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Θερμοκρασία</th>
                    <th>Σύγκριση Θερμοκρασίας</th>
                    <th>Υγρασία</th>
                    <th>Σύγκριση Υγρασίας</th>
                    <th>Ώρα</th>
                    <th>Σολένοιντ</th>
                    <th>Ενέργειες</th>
                </tr>
            </thead>
            <tbody>
                <!-- Trigger rows will be added here dynamically -->
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const triggerForm = document.getElementById('trigger-form');
            const triggerTable = document.getElementById('trigger-table').getElementsByTagName('tbody')[0];

            function fetchTriggers() {
                fetch('/get_triggers')
                    .then(response => response.json())
                    .then(data => {
                        const triggers = data.triggers;
                        triggerTable.innerHTML = ''; // Clear existing table rows
                        triggers.forEach(trigger => {
                            const row = triggerTable.insertRow();
                            row.innerHTML = `
                                <td>${trigger.id}</td>
                                <td>${trigger.temperature || '-'}</td>
                                <td>${trigger.temperature_comparison || '-'}</td>
                                <td>${trigger.humidity || '-'}</td>
                                <td>${trigger.humidity_comparison || '-'}</td>
                                <td>${trigger.time || '-'}</td>
                                <td>${trigger.solenoid || '-'}</td>
                                <td><button onclick="deleteTrigger(${trigger.id})">Διαγραφή</button></td>
                            `;
                        });
                    });
            }

            function addTrigger(data) {
                fetch('/add_trigger', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            fetchTriggers();
                            triggerForm.reset();
                        } else {
                            alert(`Σφάλμα: ${data.message}`);
                        }
                    });
            }

            function deleteTrigger(id) {
                fetch('/delete_trigger', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            fetchTriggers();
                        } else {
                            alert(`Σφάλμα: ${data.message}`);
                        }
                    });
            }

            triggerForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const data = {
                    temperature: document.getElementById('temperature').value,
                    temperature_comparison: document.getElementById('temperature_comparison').value,
                    humidity: document.getElementById('humidity').value,
                    humidity_comparison: document.getElementById('humidity_comparison').value,
                    time: document.getElementById('time').value,
                    solenoid: document.getElementById('solenoid').value
                };

                addTrigger(data);
            });

            fetchTriggers(); // Initial load of triggers
        });
    </script>
</body>

</html>